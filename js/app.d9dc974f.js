(function(e){function t(t){for(var r,a,i=t[0],u=t[1],s=t[2],d=0,l=[];d<i.length;d++)a=i[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&l.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);f&&f(t);while(l.length)l.shift()();return c.push.apply(c,s||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,a=1;a<n.length;a++){var i=n[a];0!==o[i]&&(r=!1)}r&&(c.splice(t--,1),e=u(u.s=n[0]))}return e}var r={},a={app:0},o={app:0},c=[];function i(e){return u.p+"js/"+({}[e]||e)+"."+{"chunk-0ddbda25":"7e737d71","chunk-2f9a1a58":"6f723b04","chunk-56bf2064":"e5826dad","chunk-57853822":"4973d41b","chunk-9d5554ba":"aba9013f","chunk-b97a9906":"d3dab25d"}[e]+".js"}function u(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.e=function(e){var t=[],n={"chunk-0ddbda25":1,"chunk-2f9a1a58":1,"chunk-56bf2064":1,"chunk-57853822":1,"chunk-9d5554ba":1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise((function(t,n){for(var r="css/"+({}[e]||e)+"."+{"chunk-0ddbda25":"3384612b","chunk-2f9a1a58":"f96d508e","chunk-56bf2064":"13d2eb82","chunk-57853822":"a53fe314","chunk-9d5554ba":"109b1cb4","chunk-b97a9906":"31d6cfe0"}[e]+".css",o=u.p+r,c=document.getElementsByTagName("link"),i=0;i<c.length;i++){var s=c[i],d=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(d===r||d===o))return t()}var l=document.getElementsByTagName("style");for(i=0;i<l.length;i++){s=l[i],d=s.getAttribute("data-href");if(d===r||d===o)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var r=t&&t.target&&t.target.src||o,c=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");c.code="CSS_CHUNK_LOAD_FAILED",c.request=r,delete a[e],f.parentNode.removeChild(f),n(c)},f.href=o;var h=document.getElementsByTagName("head")[0];h.appendChild(f)})).then((function(){a[e]=0})));var r=o[e];if(0!==r)if(r)t.push(r[2]);else{var c=new Promise((function(t,n){r=o[e]=[t,n]}));t.push(r[2]=c);var s,d=document.createElement("script");d.charset="utf-8",d.timeout=120,u.nc&&d.setAttribute("nonce",u.nc),d.src=i(e);var l=new Error;s=function(t){d.onerror=d.onload=null,clearTimeout(f);var n=o[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",l.name="ChunkLoadError",l.type=r,l.request=a,n[1](l)}o[e]=void 0}};var f=setTimeout((function(){s({type:"timeout",target:d})}),12e4);d.onerror=d.onload=s,document.head.appendChild(d)}return Promise.all(t)},u.m=e,u.c=r,u.d=function(e,t,n){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)u.d(n,r,function(t){return e[t]}.bind(null,r));return n},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="",u.oe=function(e){throw console.error(e),e};var s=window["webpackJsonp"]=window["webpackJsonp"]||[],d=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var f=d;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"148c":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23"),a=Object(r["createElementVNode"])("h2",null,"北邮志愿",-1),o={id:"nav"},c=Object(r["createTextVNode"])("首页"),i={key:0},u=Object(r["createTextVNode"])("活动"),s=Object(r["createTextVNode"])("帐户"),d={key:1},l=Object(r["createTextVNode"])("登陆"),f={key:2},h=Object(r["createTextVNode"])("发布");function m(e,t,n,m,p,b){var v=Object(r["resolveComponent"])("router-link"),g=Object(r["resolveComponent"])("router-view");return Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],null,[a,Object(r["createElementVNode"])("div",o,[Object(r["createElementVNode"])("span",null,[Object(r["createVNode"])(v,{to:"/"},{default:Object(r["withCtx"])((function(){return[c]})),_:1})]),p.isLogin?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",i,[Object(r["createVNode"])(v,{to:"/activities"},{default:Object(r["withCtx"])((function(){return[u]})),_:1}),Object(r["createVNode"])(v,{to:"/profile"},{default:Object(r["withCtx"])((function(){return[s]})),_:1}),Object(r["createElementVNode"])("a",{onClick:t[0]||(t[0]=function(){return b.logout&&b.logout.apply(b,arguments)}),href:"javascript: void(0);"},"登出")])):(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",d,[Object(r["createVNode"])(v,{to:"/login"},{default:Object(r["withCtx"])((function(){return[l]})),_:1})])),p.isAdmin?(Object(r["openBlock"])(),Object(r["createElementBlock"])("span",f,[Object(r["createVNode"])(v,{to:"/create"},{default:Object(r["withCtx"])((function(){return[h]})),_:1})])):Object(r["createCommentVNode"])("",!0)]),p.isRouterAlive?(Object(r["openBlock"])(),Object(r["createBlock"])(g,{key:0})):Object(r["createCommentVNode"])("",!0)],64)}n("99af");var p=n("c72e"),b=n.n(p),v={data:function(){var e;return{isLogin:b.a.User.current(),isAdmin:null===(e=b.a.User.current())||void 0===e?void 0:e.get("isAdmin"),isRouterAlive:!0}},beforeMount:function(){var e=this;this.$watch((function(){return e.$route.fullPath}),(function(){var t;e.isLogin=b.a.User.current(),e.isAdmin=null===(t=b.a.User.current())||void 0===t?void 0:t.get("isAdmin")}))},methods:{logout:function(){var e=this;b.a.User.logOut().then((function(){e.isLogin=!1,e.$message({message:"登出成功。",type:"success"}),e.$router.push("/")})).catch((function(t){e.$message({message:"[".concat(t.code,"] ").concat(t.rawMessage),type:"warning"})}))},refresh:function(){var e=this;this.isRouterAlive=!1,this.$nextTick((function(){return e.isRouterAlive=!0}))}}},g=(n("6ce3"),n("6b0d")),j=n.n(g);const y=j()(v,[["render",m]]);var O=y,k=(n("d3b7"),n("3ca3"),n("ddb0"),n("6c02")),w={class:"home"},A=Object(r["createElementVNode"])("h3",null,"本周日程",-1);function C(e,t,n,a,o,c){var i=Object(r["resolveComponent"])("el-empty"),u=Object(r["resolveComponent"])("time-chart"),s=Object(r["resolveDirective"])("loading");return Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",w,[o.user?(Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],{key:1},[A,Object(r["createVNode"])(u,{data:o.timeChartData},null,8,["data"])],64)):(Object(r["openBlock"])(),Object(r["createBlock"])(i,{key:0,description:"欢迎使用北邮志愿系统，请先登录。"}))])),[[s,o.isLoading]])}n("159b"),n("7db0"),n("d81d"),n("bf19");function E(e,t,n,a,o,c){var i=Object(r["resolveComponent"])("v-chart");return Object(r["openBlock"])(),Object(r["createBlock"])(i,{class:"chart",option:o.option},null,8,["option"])}var x=n("2909"),N=(n("fb6a"),n("b0c0"),n("5c7f")),B=n("22b4"),S=n("c32b"),V=n("052f"),L=n("9394"),T=n("4b2a"),_=n("2da7"),M=n("ff32"),P=n("f95e"),U=n("5a0c");function q(e){var t=Math.floor(e/60),n=e%60;return t="0".concat(t).slice(-2),n="0".concat(n).slice(-2),"".concat(t,":").concat(n)}function D(e,t){return 60*e+t}function I(e,t){var n=t.value(0),r=t.coord([t.value(1),n]),a=t.coord([t.value(2),n]),o=t.size([0,1])[1]*("current"==t.value(3)?.8:.6),c=S["a"].clipRectByRect({x:r[0],y:r[1]-o/2,width:a[0]-r[0],height:o},{x:e.coordSys.x,y:e.coordSys.y,width:e.coordSys.width,height:e.coordSys.height});return"current"!=t.value(3)&&(c.r=3),c&&{type:"rect",shape:c,style:t.style()}}Object(B["a"])([L["a"],V["a"],T["a"],_["a"],P["a"],M["a"]]);var F={name:"TimeChart",components:{VChart:N["a"]},props:{data:Object},watch:{data:function(e){var t,n,r,a=[];null===(t=e.week)||void 0===t||t.forEach((function(e,t){a=a.concat(e.map((function(e){return[t,D.apply(void 0,Object(x["a"])(e[0])),D.apply(void 0,Object(x["a"])(e[1])),"week"]})))}));var o=[];null===(n=e.todo)||void 0===n||n.forEach((function(e){o.push([U(e.date).day(),D(U(e.time[0]).hour(),U(e.time[0]).minute()),D(U(e.time[1]).hour(),U(e.time[1]).minute()),"todo",e.name])}));var c=[];null===(r=e.activity)||void 0===r||r.forEach((function(e){c.push([U(e.date).day(),D(U(e.time[0]).hour(),U(e.time[0]).minute()),D(U(e.time[1]).hour(),U(e.time[1]).minute()),"activity",e.name,e.aname,e.aid])}));var i=U(),u=[[i.day(),D(i.hour(),Math.max(i.minute()-3,0)),D(i.hour(),Math.min(i.minute()+3,60)),"current"]];this.option.series[0].data=a,this.option.series[1].data=o,this.option.series[2].data=c,this.option.series[3].data=u}},data:function(){var e=["周日","周一","周二","周三","周四","周五","周六"];return{option:{title:{show:!1},grid:{height:300,top:40},xAxis:{min:360,max:1320,interval:120,axisLabel:{formatter:function(e){return q(e)}},position:"top"},yAxis:{data:e,inverse:!0},color:["#409EFF","#67C23A","#E6A23C","#F56C6C"],legend:{data:["课程表","其他日程","志愿工作","目前时间"],bottom:20},tooltip:{formatter:function(t){switch(t.value[3]){case"week":return"【课程】".concat(e[t.value[0]]," ").concat(q(t.value[1])," - ").concat(q(t.value[2]));case"todo":return"【日程】".concat(e[t.value[0]]," ").concat(q(t.value[1])," - ").concat(q(t.value[2]),"\n              ").concat(t.value[4]?"（".concat(t.value[4],"）"):"");case"activity":return"【日程】".concat(e[t.value[0]]," ").concat(q(t.value[1])," - ").concat(q(t.value[2]),"\n              （").concat(t.value[5]).concat(t.value[4]?" - ".concat(t.value[4]):"","）");case"current":return"目前时间"}}},series:[{type:"custom",name:"课程表",renderItem:function(e,t){return I(e,t)}},{type:"custom",name:"其他日程",renderItem:function(e,t){return I(e,t)}},{type:"custom",name:"志愿工作",renderItem:function(e,t){return I(e,t)}},{type:"custom",name:"目前时间",renderItem:function(e,t){return I(e,t)}}]}}}};n("cf13");const R=j()(F,[["render",E],["__scopeId","data-v-08f7dd66"]]);var $=R,H=n("5a0c"),z={name:"Home",components:{TimeChart:$},data:function(){return{isLoading:!1,user:b.a.User.current(),timeChartData:{}}},beforeMount:function(){var e,t,n=this;if(this.user){this.isLoading=!0;var r=null===(e=b.a.User.current())||void 0===e?void 0:e.get("todo"),a=[],o=[];r.forEach((function(e){H().isSame(H(e.date),"week")&&a.push(e),H().isAfter(H(e.date),"week")||o.push(e)})),null===(t=b.a.User.current())||void 0===t||t.set("todo",o).save().then((function(){var e=new b.a.Query("UserActivityMap");return e.equalTo("user",n.user).find()})).then((function(e){var t=e.map((function(e){return e.toJSON()})),r=[];t.forEach((function(e){for(var t in e.joined){var n=e.joined[t];if(H().isSame(H(e.periods[n].date),"week")){var a=e.periods[n];a.aid=e.objectId,a.aname=e.title,r.push(e.periods[n])}}})),n.timeChartData={week:b.a.User.current().get("schedule"),todo:a,activity:r},n.isLoading=!1}))}}};const J=j()(z,[["render",C]]);var G=J,K=n("3ef4"),Q=[{path:"/",name:"Home",component:G},{path:"/about",name:"About",component:function(){return n.e("chunk-9d5554ba").then(n.bind(null,"f820"))},meta:{requiresAdmin:!0}},{path:"/login",name:"Login",component:function(){return n.e("chunk-0ddbda25").then(n.bind(null,"a55b"))},meta:{requiresGuest:!0}},{path:"/profile",name:"Profile",component:function(){return n.e("chunk-56bf2064").then(n.bind(null,"c66d"))},meta:{requiresAuth:!0}},{path:"/activities",name:"Activities",component:function(){return n.e("chunk-b97a9906").then(n.bind(null,"b9ce"))},meta:{requiresAuth:!0}},{path:"/activities/:id",name:"Activity",component:function(){return n.e("chunk-2f9a1a58").then(n.bind(null,"abae"))},meta:{requiresAuth:!0}},{path:"/create",name:"Create",component:function(){return n.e("chunk-57853822").then(n.bind(null,"1071"))},meta:{requiresAdmin:!0}},{path:"/edit/:id",name:"Edit",component:function(){return n.e("chunk-57853822").then(n.bind(null,"1071"))},meta:{requiresAdmin:!0}}],Y=Object(k["a"])({history:Object(k["b"])(),routes:Q});Y.beforeEach((function(e){var t=b.a.User.current();return!e.meta.requiresAdmin||null!==t&&void 0!==t&&t.get("isAdmin")?e.meta.requiresAuth&&!t?(Object(K["a"])({message:"本页面需要登陆才能查看。",type:"warning"}),{path:"/login"}):e.meta.requiresGuest&&t?(Object(K["a"])({message:"您已经登陆，无需再次登陆。如需切换账号，请先登出。",type:"warning"}),!1):void 0:(Object(K["a"])({message:"本页面需要管理员权限才能查看。",type:"warning"}),!1)}));var X=Y,W=n("c3a1"),Z=(n("7437"),n("c1a0")),ee=n("d627"),te=n("971b"),ne=n("5502"),re=Object(ne["a"])({state:{},mutations:{catchError:function(e,t){Object(K["a"])({message:"[".concat(t.code,"] ").concat(t.rawMessage),type:"warning"})}},actions:{},modules:{}});b.a.init({appId:"gtJmljD7lYSo9rNzfuH0vPDS-MdYXbMMI",appKey:"Ur1HYhjugdyQSBQPFsoGv4wP"});var ae=n("5a0c");n("a471");var oe=n("b002"),ce=n("7e21");ae.extend(oe),ae.extend(ce),ae.updateLocale("zh-cn",{weekStart:0}),ae.locale("zh-cn"),Object(r["createApp"])(O).use(re).use(X).use(W["a"],{locale:Z["a"]}).component("User",ee["a"]).component("Key",te["a"]).mount("#app")},"6ce3":function(e,t,n){"use strict";n("148c")},"99fc":function(e,t,n){},cf13:function(e,t,n){"use strict";n("99fc")}});
//# sourceMappingURL=app.d9dc974f.js.map