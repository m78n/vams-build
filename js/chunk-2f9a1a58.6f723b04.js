(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2f9a1a58"],{"1dd4":function(e,t,n){},"2e00":function(e,t,n){"use strict";n("1dd4")},"408a":function(e,t,n){var r=n("e330");e.exports=r(1..valueOf)},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,n){var r=n("e330"),c=n("1d80"),i=n("577e"),o=n("5899"),a=r("".replace),u="["+o+"]",s=RegExp("^"+u+u+"*"),l=RegExp(u+u+"*$"),d=function(e){return function(t){var n=i(c(t));return 1&e&&(n=a(n,s,"")),2&e&&(n=a(n,l,"")),n}};e.exports={start:d(1),end:d(2),trim:d(3)}},a9e3:function(e,t,n){"use strict";var r=n("83ab"),c=n("da84"),i=n("e330"),o=n("94ca"),a=n("6eeb"),u=n("1a2d"),s=n("7156"),l=n("3a9b"),d=n("d9b5"),b=n("c04e"),f=n("d039"),m=n("241c").f,p=n("06cf").f,O=n("9bf2").f,j=n("408a"),h=n("58a8").trim,g="Number",v=c[g],N=v.prototype,k=c.TypeError,C=i("".slice),y=i("".charCodeAt),V=function(e){var t=b(e,"number");return"bigint"==typeof t?t:x(t)},x=function(e){var t,n,r,c,i,o,a,u,s=b(e,"number");if(d(s))throw k("Cannot convert a Symbol value to a number");if("string"==typeof s&&s.length>2)if(s=h(s),t=y(s,0),43===t||45===t){if(n=y(s,2),88===n||120===n)return NaN}else if(48===t){switch(y(s,1)){case 66:case 98:r=2,c=49;break;case 79:case 111:r=8,c=55;break;default:return+s}for(i=C(s,2),o=i.length,a=0;a<o;a++)if(u=y(i,a),u<48||u>c)return NaN;return parseInt(i,r)}return+s};if(o(g,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var S,w=function(e){var t=arguments.length<1?0:v(V(e)),n=this;return l(N,n)&&f((function(){j(n)}))?s(Object(t),n,w):t},D=r?m(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),E=0;D.length>E;E++)u(v,S=D[E])&&!u(w,S)&&O(w,S,p(v,S));w.prototype=N,N.constructor=w,a(c,g,w)}},abae:function(e,t,n){"use strict";n.r(t);n("b0c0");var r=n("7a23"),c=function(e){return Object(r["pushScopeId"])("data-v-32303aff"),e=e(),Object(r["popScopeId"])(),e},i={class:"activity"},o=["innerHTML"],a=Object(r["createTextVNode"])("报名截止"),u=Object(r["createTextVNode"])("取消报名"),s=Object(r["createTextVNode"])("报名"),l=Object(r["createTextVNode"])("编辑"),d=c((function(){return Object(r["createElementVNode"])("h3",null,"报名者列表",-1)})),b=Object(r["createTextVNode"])("删除"),f=c((function(){return Object(r["createElementVNode"])("span",null,[Object(r["createTextVNode"])("已经自动为您选择了与日程不冲突的若干时段，您可以手动调整。注意：颜色为"),Object(r["createElementVNode"])("span",{class:"warning"},"黄色"),Object(r["createTextVNode"])("的时段与您的日程存在冲突，请慎重选择。")],-1)})),m={class:"dialog-footer"},p=Object(r["createTextVNode"])("取消"),O=Object(r["createTextVNode"])("报名");function j(e,t,n,c,j,h){var g=Object(r["resolveComponent"])("el-progress"),v=Object(r["resolveComponent"])("el-row"),N=Object(r["resolveComponent"])("el-timeline-item"),k=Object(r["resolveComponent"])("el-tag"),C=Object(r["resolveComponent"])("el-timeline"),y=Object(r["resolveComponent"])("el-button"),V=Object(r["resolveComponent"])("el-table-column"),x=Object(r["resolveComponent"])("el-table"),S=Object(r["resolveComponent"])("el-empty"),w=Object(r["resolveComponent"])("el-checkbox"),D=Object(r["resolveComponent"])("el-checkbox-group"),E=Object(r["resolveComponent"])("el-dialog"),_=Object(r["resolveDirective"])("loading");return Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],null,[Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",i,[j.item?(Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],{key:0},[Object(r["createVNode"])(v,null,{default:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(j.item.title),1),Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(j.campuses[j.item.campus])+"校区 / "+Object(r["toDisplayString"])(j.item.site)+" ",1),Object(r["createVNode"])(g,{percentage:h.totalPercentage,status:h.progressStatus},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(" 已报名 "+Object(r["toDisplayString"])(j.totalCount)+" / "+Object(r["toDisplayString"])(j.item.maxNeed),1)]})),_:1},8,["percentage","status"]),Object(r["createElementVNode"])("div",{class:"activity-desc left",innerHTML:j.item.desc},null,8,o)]})),_:1}),Object(r["createVNode"])(v,null,{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(C,{class:"left"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(N,{timestamp:j.dueString},{default:Object(r["withCtx"])((function(){return[a]})),_:1},8,["timestamp"]),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(j.item.periods,(function(e,t){return Object(r["openBlock"])(),Object(r["createBlock"])(N,{key:t,timestamp:j.periodString[t],color:j.timelineColor[j.timelineData[t]]},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.name?e.name:"时段 ".concat(t+1))+" ",1),Object(r["createVNode"])(k,{type:j.timelineStatus[j.timelineData[t]],size:"small"},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(j.timelineHint[j.timelineData[t]]),1)]})),_:2},1032,["type"]),Object(r["createVNode"])(g,{percentage:j.percentages[t]},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(" 已报名 "+Object(r["toDisplayString"])(j.counts[t])+" / "+Object(r["toDisplayString"])(j.item.periods[t].need),1)]})),_:2},1032,["percentage"])]})),_:2},1032,["timestamp","color"])})),128))]})),_:1})]})),_:1}),Object(r["createVNode"])(v,null,{default:Object(r["withCtx"])((function(){return[h.canSign?(Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],{key:0},[h.signStatus?(Object(r["openBlock"])(),Object(r["createBlock"])(y,{key:0,type:"info",onClick:h.cancel},{default:Object(r["withCtx"])((function(){return[u]})),_:1},8,["onClick"])):(Object(r["openBlock"])(),Object(r["createBlock"])(y,{key:1,type:"primary",onClick:t[0]||(t[0]=function(e){return j.isSignDialogOpen=!0})},{default:Object(r["withCtx"])((function(){return[s]})),_:1}))],64)):Object(r["createCommentVNode"])("",!0),j.isPoster?(Object(r["openBlock"])(),Object(r["createBlock"])(y,{key:1,onClick:h.edit},{default:Object(r["withCtx"])((function(){return[l]})),_:1},8,["onClick"])):Object(r["createCommentVNode"])("",!0)]})),_:1}),Object(r["createVNode"])(v,null,{default:Object(r["withCtx"])((function(){return[d,j.users.length?(Object(r["openBlock"])(),Object(r["createBlock"])(x,{key:0,style:{width:"100%"},data:j.users},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(V,{prop:"username",label:"用户名",width:"150"}),Object(r["createVNode"])(V,{prop:"joined",label:"报名时段",width:"150"}),Object(r["createVNode"])(V,{prop:"createdAt",label:"报名时间",width:"200"}),j.isPoster?(Object(r["openBlock"])(),Object(r["createBlock"])(V,{key:0,label:"操作",fixed:"right",width:"100"},{default:Object(r["withCtx"])((function(t){return[Object(r["createVNode"])(y,{type:"danger",onClick:function(n){return e.deleteRecord(t)}},{default:Object(r["withCtx"])((function(){return[b]})),_:2},1032,["onClick"])]})),_:1})):Object(r["createCommentVNode"])("",!0)]})),_:1},8,["data"])):Object(r["createCommentVNode"])("",!0)]})),_:1})],64)):(Object(r["openBlock"])(),Object(r["createBlock"])(S,{key:1,description:"走错路了😡"}))])),[[_,j.isLoading]]),Object(r["createVNode"])(E,{modelValue:j.isSignDialogOpen,"onUpdate:modelValue":t[3]||(t[3]=function(e){return j.isSignDialogOpen=e}),title:"报名"},{footer:Object(r["withCtx"])((function(){return[Object(r["createElementVNode"])("span",m,[Object(r["createVNode"])(y,{onClick:t[2]||(t[2]=function(e){return j.isSignDialogOpen=!1})},{default:Object(r["withCtx"])((function(){return[p]})),_:1}),Object(r["createVNode"])(y,{type:"primary",disabled:0==j.checkedPeriods.length,onClick:h.signIn},{default:Object(r["withCtx"])((function(){return[O]})),_:1},8,["disabled","onClick"])])]})),default:Object(r["withCtx"])((function(){return[f,Object(r["createElementVNode"])("span",null,[Object(r["createVNode"])(D,{modelValue:j.checkedPeriods,"onUpdate:modelValue":t[1]||(t[1]=function(e){return j.checkedPeriods=e})},{default:Object(r["withCtx"])((function(){return[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(j.item.periods,(function(e,t){return Object(r["openBlock"])(),Object(r["createBlock"])(w,{key:t,label:t,class:Object(r["normalizeClass"])({warning:3==j.timelineData[t]}),disabled:0==j.timelineData[t]},{default:Object(r["withCtx"])((function(){return[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.name?e.name:"时段 ".concat(t+1)),1)]})),_:2},1032,["label","class","disabled"])})),128))]})),_:1},8,["modelValue"])])]})),_:1},8,["modelValue"])],64)}n("bf19"),n("7db0"),n("d3b7"),n("159b"),n("a9e3"),n("99af"),n("d81d");var h=n("c72e"),g=n.n(h),v=n("5a0c"),N={name:"Activity",data:function(){return{user:g.a.User.current(),isLoading:!0,isPoster:!1,activity:void 0,item:void 0,record:void 0,records:[],totalCount:0,counts:[],percentages:[],users:[],campuses:["西土城","沙河","宏福"],timelineData:[],timelineStatus:["danger","success","","warning","info"],timelineHint:["已截止","已报名","可报名","有冲突","已报满"],timelineColor:["#F56C6C","#67C23A","#409EFF","#E6A23C","#909399"],dueString:"",periodString:[],isSignDialogOpen:!1,checkedPeriods:[]}},computed:{totalPercentage:function(){return Math.floor(this.totalCount/this.item.maxNeed*100)},canSign:function(){return v().isBefore(v(this.item.due))},progressStatus:function(){return this.canSign?100==this.totalPercentage?"success":"":"warning"},signStatus:function(){return void 0!==this.record}},beforeMount:function(){var e=this;this.isLoading=!0;var t=new g.a.Query("Activity");t.get(this.$route.params.id).then((function(t){var n;e.item=t.toJSON(),e.activity=t,e.isPoster=(null===(n=e.item.from)||void 0===n?void 0:n.objectId)==e.user.id;var r=new g.a.Query("UserActivityMap");return r.equalTo("user",e.user),r.find()})).then((function(t){for(var n in t)t[n].get("activity").id==e.item.objectId&&(e.record=t[n]);e.records=t;var r=new g.a.Query("UserActivityMap");return r.equalTo("activity",e.activity),r.findAndCount()})).then((function(t){for(var n,r,c,i=0;i<e.item.periods.length;i++)e.counts.push(0);for(var o in t[0]){t[0][o].get("joined").forEach((function(t){return e.counts[t]+=1})),e.totalCount+=t[0][o].get("joined").length;var a=t[0][o].toJSON();a.createdAt=v(a.createdAt).format("YYYY-MM-DD HH:mm"),e.users.push(a)}for(var u in e.item.periods)e.percentages.push(Math.floor(e.counts[u]/e.item.periods[u].need*100));var s=function(e){return Number(v(e).format("HHmm"))},l=function(e){return Number("".concat(e[0]).concat(e[1]))},d=e.user.get("todo");e.dueString=v(e.item.due).format("YYYY-MM-DD HH:mm"),e.periodString=null===(n=e.item.periods)||void 0===n?void 0:n.map((function(e){return"\n                ".concat(v(e.date).format("YYYY-MM-DD"),"\n                ").concat(v(e.time[0]).format("HH:mm")," -\n                ").concat(v(e.time[1]).format("HH:mm"),"\n            ")})),e.timelineData=null===(r=e.item.periods)||void 0===r?void 0:r.map((function(t,n){if(t.need==e.counts[n])return 4;if(!e.canSign)return 0;var r=s(t.time[0]),c=s(t.time[1]),i=e.user.get("schedule")[v(t.date).day()];for(var o in i){var a=i[o],u=l(a[0]),b=l(a[1]);if(u<c&&r<b)return 3}for(var f in d){var m=d[f];if(v(m.date).isSame(v(t.date),"day")){var p=s(m.time[0]),O=s(m.time[1]);if(p<c&&r<O)return 3}}for(var j in e.records){var h=e.records[j].toJSON();for(var g in h.joined){var N=h.periods[h.joined[g]];if(v(N.date).isSame(v(t.date),"day")){var k=s(N.time[0]),C=s(N.time[1]);if(k<c&&r<C)return 3}}}return e.checkedPeriods.length<3&&e.checkedPeriods.push(n),2})),null===(c=e.record)||void 0===c||c.get("joined").forEach((function(t){return e.timelineData[t]=1})),e.isLoading=!1}))},methods:{edit:function(){this.$router.push("/edit/"+this.$route.params.id)},signIn:function(){var e=this;this.isSignDialogOpen=!1,this.isLoading=!0;var t=new g.a.Object("UserActivityMap");t.set("user",this.user),t.set("activity",this.activity),t.set("periods",this.item.periods),t.set("joined",this.checkedPeriods),t.set("username",this.user.getUsername()),t.set("title",this.item.title),t.set("campus",this.item.campus),t.set("site",this.item.site),t.save().then((function(){e.$root.refresh()}))},cancel:function(){var e=this;this.record.destroy().then((function(){e.$root.refresh()}))}}},k=(n("2e00"),n("6b0d")),C=n.n(k);const y=C()(N,[["render",j],["__scopeId","data-v-32303aff"]]);t["default"]=y}}]);
//# sourceMappingURL=chunk-2f9a1a58.6f723b04.js.map